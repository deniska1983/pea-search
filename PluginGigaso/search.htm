<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>gigaso</title>
    <link rel="stylesheet" href="./main.css" type="text/css" />
    <link rel="shortcut icon" href="./favicon.ico" type="image/ico" />
    <link rel="icon" href="./favicon.ico" type="image/ico" />
	<script type="text/javascript" src="jquery-1.6.min.js"></script>
	<script type="text/javascript" src="jquery-jtemplates.js"></script>
    <script type="text/javascript" src="jquery.contextmenu.r2.js"></script>
    <script type="text/javascript" src="jquery.corner.js"></script>
    <script type="text/javascript" src="jquery-ui-1.8.12.custom.min.js"></script>
    <script type="text/javascript" src="message.js"></script>
    <script type="text/javascript" src="context.js"></script>
    <script type="text/javascript" src="scroll.js"></script>
</head>

<body>
<object id="plugin0" type="application/x-plugingigaso" width="10" height="10">
</object>

<center style="margin:10px;">
搜索：<input id="search" name="s" type="text" size="35" value="" title="查询条件"><img id="search_img" src="images/find.ico"/>
</center>

<table  id="maintable" class="maintable" width="100%" cellspacing="0">
	<thead>
        <tr>
            <th style="width:33%" colid="0" nowrap>文件名</th>
            <th style="width:50%" colid="1">文件夹</th>
            <th style="width:5%" align="right" colid="2" nowrap>大小</th>
            <th style="width:12%" align="right" colid="3" nowrap>修改日期</th>
        </tr>
	</thead>
	<tbody id="result1"> 
	</tbody> 
</table>

<textarea id="template" style="display:none"> 
		{#foreach $T as record}
        <tr>
            <td colid="0" nowrap>
				<img width="16" height="16" src="icons/{$T.record.type}.ico" />
				<input type="hidden" value="{$T.record.type}">
				<span title="{$T.record.name2}">{$T.record.name}</span>
            </td>
            <td colid="1">
				<span title="{$T.record.path2}">{$T.record.path}</span>
            </td>
            <td align="right" colid="2" nowrap>
				<span>{$T.record.size}</span>
            </td>
            <td align="right" colid="3" nowrap>
				<span>{$T.record.time}</span>
            </td>
        </tr>
		{#/for}
</textarea> 

<div id="message-area" style="opacity: 0;">no message.</div> 

  <div id="myMenu1" style="display:none;">
    <ul style="font-size:10pt">
      <li id="default"><img width="16" height="16" src="./images/win.png"> 打开</li>
      <li id="openas"><img width="16" height="16" src="./images/openas.ico"> 打开方式</li>
      <li id="explore"><img  width="16" height="16" src="./images/explore.ico"> 资源管理器</li>
      <li id="copypath"><img  width="16" height="16" src="./images/copypath.ico"> 复制全路径到剪贴板</li>
      <li id="copy"><img  width="16" height="16" src="./images/copy.ico"> 复制</li>
      <li id="cut"><img  width="16" height="16" src="./images/cut.ico"> 剪切</li>
      <li id="paste"><img  width="16" height="16" src="./images/paste.ico"> 粘贴</li>
      <li id="delete"><img  width="16" height="16" src="./images/delete.ico"> 删除</li>
      <li id="prop"><img  width="16" height="16" src="./images/prop.ico"> 属性</li>
    </ul>
  </div>

    <script type="text/javascript">
        function plugin0(){
            return document.getElementById('plugin0');
        }
		function ieTrOver(){this.oldClassName=this.className;this.className="hovered"}
		function ieTrOut(){this.className=this.oldClassName}
		function table_over(){
				$("table tr:nth-child(even)").addClass("d");
				if(window.ActiveXObject){
					$('tr').each(function(n){
						this.onmouseover = ieTrOver;
						this.onmouseout = ieTrOut;
					});
				}
				$("#maintable tbody tr").contextMenu('myMenu1', context_menu_obj);
		  }
</script>
    <script type="text/javascript">
		var last_search;
		var files = [];
		var search_timeout;
        function searchf(value){
			if(last_search == value) return;
			clearTimeout(search_timeout);
			var pagerow = 200;
			var page_from = 0;
			var first = true;
			$("#result1").setTemplateElement("template");

			$(window).bind('scroll',function(e){
				if(files.length > page_from){
					show_info(page_from);
					if(reachBottom()) page();
				}
			});

			function page(){
				var to = page_from + pagerow;
				if($("#search").val()!=value) return; //查询已过期
				if(page_from==0){
					$("#result1").processTemplate(files.slice(page_from,to));
				}else{
					if(files.length<=page_from) return;
					$("#result1").processTemplateAppend(files.slice(page_from,to));
				}
				page_from=to;
				if(files.length<=to){
					show_info("分页完成");
				}
				table_over();
			}
			function searchf0(){
				var s = plugin0().search(value);
				if($("#search").val()!=value) return; //查询已过期
				files = eval(s);
				$(files).each( function sub(i,obj){
					if(obj.name.length>36){
						obj.name2 = obj.name;
						obj.name = obj.name2.substring(0, 16)+"..."+obj.name2.substring(obj.name2.length-17, obj.name2.length);
					}
					if(obj.path.length>55){
						obj.path2 = obj.path;
						obj.path = obj.path2.substring(0, 26)+"..."+obj.path2.substring(obj.path2.length-26, obj.path2.length);
					}
				});
				if(files.length==1000) files.push({type:"unknown", name:"......", path:"超过1000条的记录不显示"});
				page();
				last_search = value;
			}
			if(value.length<3){
				search_timeout = setTimeout(searchf0,300);
			}else if(value.length<5){
				search_timeout = setTimeout(searchf0,150);
			}else{
				search_timeout = setTimeout(searchf0,50);
			}        
		}
		$(function() {
			$("#search").focus();
			$("#search").bind('keyup',function(event){searchf($("#search").val())});
			$("#maintable thead tr th:first").append("<img src='images/s_asc.png' />");
			$("#message-area").corner("bottom 3px");
			$(document).bind("contextmenu", function(e){
				//return false;
			});
			$( "#search_img").position({
				of: $( "#search" ),
				my: "right top",
				at: "right center",
				offset: "0px"
			});
		});
    </script>

</body>

</html>
