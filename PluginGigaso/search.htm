<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>gigaso</title>
    <link rel="stylesheet" href="./main.css" type="text/css" />
    <link rel="shortcut icon" href="./favicon.ico" type="image/ico" />
    <link rel="icon" href="./favicon.ico" type="image/ico" />
	<script type="text/javascript" src="jquery-1.6.min.js"></script>
	<script type="text/javascript" src="jquery-jtemplates.js"></script>
    <script type="text/javascript" src="jquery.contextmenu.r2.js"></script>
</head>

<body>
<object id="plugin0" type="application/x-plugingigaso" width="10" height="10">
</object>

    <table>
        <tr>
            <td>
                <img src="./everything.png" alt="Everything" width="164" height="40" />
            </td>
            <td nowrap>
                <input id="search" name="s" type="text" size="35" title="Search Everything" value="">
            </td>
        </tr>
    </table>

    <table  id="maintable" class="maintable" width="100%" cellspacing="0">
	<thead>
        <tr>
            <th>文件名</th>
            <th>文件夹</th>
            <th align="right">大小</th>
            <th align="right">修改日期</th>
        </tr>
	</thead>
	<tbody id="result1"> 
	</tbody> 
    </table>

<textarea id="template" style="display:none"> 
		{#foreach $T as record}
        <tr>
            <td nowrap>
				<img width="16" height="16" src="icons/{$T.record.type}.ico" />
				<input type="hidden" value="{$T.record.type}">
				<span>{$T.record.name}</span>
            </td>
            <td nowrap>
				<span>{$T.record.path}</span>
            </td>
            <td align="right" nowrap>
				<span>{$T.record.size}</span>
            </td>
            <td align="right" nowrap>
				<span>{$T.record.time}</span>
            </td>
        </tr>
		{#/for}
</textarea> 

  <div id="myMenu1" style="display: none; ">
    <ul style="font-size:10pt">
      <li id="default"><img width="16" height="16" src="./images/win.png"> 打开</li>
      <li id="openas"><img width="16" height="16" src="./images/openas.ico"> 打开方式</li>
      <li id="explore"><img  width="16" height="16" src="./images/explore.ico"> 资源管理器</li>
      <li id="edit"><img  width="16" height="16" src="./images/edit.ico"> 编辑</li>
      <li id="copy"><img  width="16" height="16" src="./images/copy.ico"> 复制</li>
      <li id="cut"><img  width="16" height="16" src="./images/cut.ico"> 剪切</li>
      <li id="paste"><img  width="16" height="16" src="./images/paste.ico"> 粘贴</li>
      <li id="delete"><img  width="16" height="16" src="./images/delete.ico"> 删除</li>
      <li id="prop"><img  width="16" height="16" src="./images/prop.ico"> 属性</li>
    </ul>
  </div>

    <script type="text/javascript">
        function plugin0(){
            return document.getElementById('plugin0');
        }
		function ieTrOver(){this.oldClassName=this.className;this.className="hovered"}
		function ieTrOut(){this.className=this.oldClassName}
		function table_over(){
				$("table tr:nth-child(even)").addClass("d");
				if(window.ActiveXObject){
					$('tr').each(function(n){
						this.onmouseover = ieTrOver;
						this.onmouseout = ieTrOut;
					});
				}
				$("table tbody tr").contextMenu('myMenu1', {
				  menuStyle: {
				  },
				  itemStyle: {
				  },
				  itemHoverStyle: {
				  },
				  bindings: {
					  'default': function(t) {
					    var tmp = $(t);
						var file = tmp.find("td span")[0].innerHTML;
						var path = tmp.find("td span")[1].innerHTML;
						var ret = plugin0().shell2_default(path+file);
						if(!ret) alert(ret);
					  },
					  'openas': function(t) {
					    var tmp = $(t);
						var file = tmp.find("td span")[0].innerHTML;
						var path = tmp.find("td span")[1].innerHTML;
						var ret = plugin0().shell2_openas(path+file);
						if(!ret) alert(ret);
					  },
					  'edit': function(t) {
					    var tmp = $(t);
						var file = tmp.find("td span")[0].innerHTML;
						var path = tmp.find("td span")[1].innerHTML;
						var ret = plugin0().shell_edit(path+file);
						if(ret<33) alert(ret);
					  },
					  'explore': function(t) {
					    var tmp = $(t);
						var file = tmp.find("td span")[0].innerHTML;
						var path = tmp.find("td span")[1].innerHTML;
						var type = tmp.find("td input")[0].value;
						if(type=="dir") plugin0().shell_explore(path+file);
						else  plugin0().shell_explore(path);
					  },
					  'delete': function(t) {
					    var tmp = $(t);
						var file = tmp.find("td span")[0].innerHTML;
						var path = tmp.find("td span")[1].innerHTML;
						var ret = plugin0().shell_delete(path+file);
						if(ret<33) alert(ret);
					  },
					  'prop': function(t) {
					    var tmp = $(t);
						var file = tmp.find("td span")[0].innerHTML;
						var path = tmp.find("td span")[1].innerHTML;
						var ret = plugin0().shell2_prop(path+file);
						if(!ret) alert(ret);
					  }
					}
				  });
		  }
		var last_search;
		var page_timeout;
		var search_timeout;
        function searchf(value){
			if(last_search == value) return;
			clearTimeout(page_timeout);
			clearTimeout(search_timeout);
			var pagerow = 50;
			var files = [];
			var first = true;
			$("#result1").setTemplateElement("template");
			function page(){
				if($("#search").val()!=value) return; //查询已过期
				if(first){
					$("#result1").processTemplate(files.slice(0,pagerow));
					first = false;
				}
				else{
					$("#result1").processTemplateAppend(files.slice(0,pagerow));
				}
				if(files.length>pagerow){
					files = files.slice(pagerow,files.length);
					page_timeout = setTimeout(page,100);
				}
				table_over();
			}
			function searchf0(){
				var s = plugin0().search(value);
				if($("#search").val()!=value) return; //查询已过期
				files = eval(s);
				if(files.length==1000) files.push({type:"unknown", name:"......", path:"超过1000条的记录不显示"});
				page();
				last_search = value;
			}
			if(value.length<3){
				search_timeout = setTimeout(searchf0,300);
			}else if(value.length<5){
				search_timeout = setTimeout(searchf0,150);
			}else{
				search_timeout = setTimeout(searchf0,50);
			}        }
		$(function() {
			$("#search").focus();
			$("#search").bind('keyup',function(event){searchf($("#search").val())});
			$("#maintable thead tr th:first").append("<img src='images/s_asc.png' />");
		});
    </script>

</body>

</html>
